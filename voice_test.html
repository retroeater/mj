<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<title>リンク（テスト）</title>
<link rel="shortcut icon" href="favicon.ico" />
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <script>
        var flag_speech = 0;
 
        function vr_function() {
            window.SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
            var recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja';
            recognition.interimResults = true;
            recognition.continuous = true;
 
            recognition.onsoundstart = function() {
                document.getElementById('status').innerHTML = "認識中";
            };
            recognition.onnomatch = function() {
                document.getElementById('status').innerHTML = "もう一度試してください";
            };
            recognition.onerror = function() {
                document.getElementById('status').innerHTML = "エラー";
                if(flag_speech == 0)
                  vr_function();
            };
            recognition.onsoundend = function() {
                document.getElementById('status').innerHTML = "停止中";
                  vr_function();
            };
 
            recognition.onresult = function(event) {
                var results = event.results;
                for (var i = event.resultIndex; i < results.length; i++) {
                    if (results[i].isFinal)
                    {
                        document.getElementById('result_text').innerHTML = results[i][0].transcript;
                        vr_function();
                    }
                    else
                    {
                        document.getElementById('result_text').innerHTML = "[途中経過] " + results[i][0].transcript;
                        flag_speech = 1;
                    }
                }
            }
            flag_speech = 0;
            document.getElementById('status').innerHTML = "start";
            recognition.start();
        }
    </script> 
</head>
 <body>
<!-- Bootstrap Navigation Bar -->
<nav class="navbar navbar-expand-sm navbar-dark bg-dark mt-3 mb-3">
	<a class="navbar-brand" href="#">麻雀</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	
	<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
		<ul class="navbar-nav">
			<li class="nav-item"><a class="nav-link" href="index.html">ホーム</span></a></li>
			<li class="nav-item"><a class="nav-link" href="bio.html">略歴</a></li>
			<li class="nav-item"><a class="nav-link active" href="results.html">成績</a></li>
			<li class="nav-item"><a class="nav-link" href="league.html">リーグ</a></li>
			<li class="nav-item"><a class="nav-link" href="media.html">メディア</a></li>
			<li class="nav-item"><a class="nav-link" href="rules.html">ルール</a></li>
			<li class="nav-item"><a class="nav-link" href="links.html">リンク</a></li>
		</ul>
	</div>
</nav>

<!-- Bootstrap -- jQuery, Popper.js, Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>    

<script type="text/javascript">
  var speech_count = 0;
  document.getElementById("start_recognition").onclick = function vr_function() {
    var result_text = document.getElementById('result_text');
    while (result_text.firstChild) {
      result_text.removeChild(result_text.firstChild);
    }
    SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'ja';
    recognition.interimResults = true;
    recognition.continuous = true;
    recognition.onresult = function(event) {
      var results = event.results;
      if (document.getElementById('interim_result') == null) {
        var interim = document.createElement('d' + 'iv');
        interim.setAttribute('class', 'results');
        interim.setAttribute('id', 'interim_result');
        document.getElementById('result_text').appendChild(interim);
      }
      for (var i = event.resultIndex; i < results.length; i++) {
        if (results[i].isFinal) {
          speech_count++;
          result_line = "<font size='4'>" + results[i][0].transcript + "</font>";
          document.getElementById('interim_result').innerHTML = result_line;
          document.getElementById('interim_result').setAttribute('id', 'result' + speech_count);
          document.getElementById('search_param').setAttribute('value', results[i][0].transcript);
          document.googleform.submit();
          document.getElementById('status').innerHTML = "status: searched!";
          recognition.stop();
          return;
        } else {
          document.getElementById('interim_result').innerHTML = "<font size='4' color='gray'>" + results[i][0].transcript + "</font>";
          flag_speech = 1;
        }
      }
    }
    document.getElementById('status').innerHTML = "status: recording...";
    recognition.start();
  }
</script>

1
2
3
4
5
6
7
8
9
10
11
12
<div style="border:1px solid #000;">
  <div id="result_text"></div>
  <form name="googleform" target="newtab" action="http://www.google.co.jp/search" method="GET" style="display:none;">
    <input type="hidden" name="hl" value="ja">
    <input type="hidden" name="q" id="search_param" maxLength="255" size="30">
  </form>
  <input type="submit" id="start_recognition" value="音声入力でGoogle検索開始！" style="color:#000; background-color:#ff9b00cf;">
</div>
<br>
<div id="status">
status: stop
</div>

</body>
</html>
